<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Productos - Pasteler√≠a Mil Sabores</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&family=Pacifico&display=swap" rel="stylesheet"/>

  <style>
    :root{
      --bg-cream:#FFF5E1;
      --rose:#FFC0CB;
      --choco:#8B4513;
      --text:#5D4037;
    }
    body{ background:var(--bg-cream); color:var(--text); font-family:'Lato',sans-serif; }

    .topbar{ background:var(--bg-cream); border-bottom:2px solid var(--rose); padding:.65rem 0; }
    .brand-logo{ height:32px; width:auto; border-radius:4px; }
    .brand-name{ font-family:'Pacifico',cursive; color:var(--choco); font-size:1.4rem; line-height:1; }
    .top-links a{ color:var(--text); text-decoration:none; font-weight:500; }
    .top-links a:hover{ color:var(--choco); text-decoration:underline; }
    .top-links span{ margin:0 .6rem; color:#b9a29b; }

    .page-title{ font-family:'Pacifico',cursive; color:var(--choco); text-align:center; margin:24px 0 12px; }

    /* FILTROS */
    .filters{ background:#ffecec; border:1px solid var(--rose); border-radius:.5rem; padding:12px; margin-bottom:16px; }
    .filters label{ font-weight:600; color:var(--choco); }

    /* CARDS */
    .card{ border:none; background:#fff; box-shadow:0 4px 8px rgba(0,0,0,.1); transition:transform .2s; }
    .card:hover{ transform:translateY(-4px); }
    .card-title{ font-weight:600; color:var(--choco); font-size:1rem; }
    .card-text{ font-size:.9rem; flex-grow:1; margin-bottom:10px; }
    .price{ color:#5D4037; font-weight:700; }
    .btn-add{ background:var(--rose); border:none; color:var(--text); font-weight:600; padding:.35rem .9rem; }
    .btn-add:hover{ background:#ffb6c1; }

    footer{ background:var(--choco); color:#fff; text-align:center; padding:20px 0; margin-top:40px; }
  </style>
</head>
<body>
  <!-- NAVBAR -->
  <header class="topbar">
    <div class="container d-flex align-items-center">
      <div class="d-flex align-items-center gap-2">
        <img src="assets/images/logo-pasteleria.png" alt="Pasteler√≠a Mil Sabores" class="brand-logo">
        <span class="brand-name">Pasteler√≠a Mil Sabores</span>
      </div>

      <nav class="ms-4 flex-grow-1 d-none d-md-flex justify-content-center top-links">
        <a href="index.html">Inicio</a><span>|</span>
        <a href="productos.html">Productos</a><span>|</span>
        <a href="#">Nosotros</a><span>|</span>
        <a href="#">Blogs</a><span>|</span>
        <a href="#">Contacto</a>
      </nav>

      <div class="ms-auto d-flex align-items-center gap-2">
        <span>üõí</span>
        <!-- Carrito como hiperv√≠nculo -->
        <a id="cartLink" href="carrito.html" class="text-decoration-none" style="color:#5D4037;">Carrito (0)</a>
      </div>
    </div>
  </header>

  <main class="container">
    <h1 class="page-title">PRODUCTOS</h1>

    <!-- FILTROS -->
    <div class="filters">
      <div class="row g-2 align-items-end">
        <div class="col-sm-6 col-md-4">
          <label for="filtroCategoria" class="form-label">Categor√≠a</label>
          <select id="filtroCategoria" class="form-select">
            <option value="TODAS">Todas</option>
            <option value="TORTA_CUADRADA">Tortas Cuadradas</option>
            <option value="TORTA_CIRCULAR">Tortas Circulares</option>
            <option value="INDIVIDUAL">Postres Individuales</option>
            <option value="SIN_AZUCAR">Productos Sin Az√∫car</option>
            <option value="SIN_GLUTEN">Productos Sin Gluten</option>
            <option value="VEGANA">Productos Veganos</option>
            <option value="TRADICIONAL">Pasteler√≠a Tradicional</option>
            <option value="ESPECIAL">Tortas Especiales</option>
          </select>
        </div>
        <div class="col-sm-6 col-md-4">
          <label for="filtroTamano" class="form-label">Tama√±o (para tortas)</label>
          <select id="filtroTamano" class="form-select">
            <option value="TODOS">Todos</option>
            <option value="PEQUENA">Peque√±a</option>
            <option value="MEDIANA">Mediana</option>
            <option value="GRANDE">Grande</option>
          </select>
        </div>
        <div class="col-sm-12 col-md-4">
          <button id="btnLimpiar" class="btn btn-outline-secondary w-100">Limpiar filtros</button>
        </div>
      </div>
    </div>

    <!-- GRID -->
    <div id="gridProductos" class="row g-4">
      <!-- 16 productos en orden de categor√≠as -->

      <!-- Tortas Cuadradas -->
      <!-- TC001 -->
      <div class="col-lg-3 col-md-4 col-sm-6 producto"
           data-cat="TORTA_CUADRADA" data-sizes="PEQUENA,MEDIANA,GRANDE" data-name="Torta Cuadrada de Chocolate" data-price="45000">
        <div class="card h-100">
          <img src="assets/images/torta_chocolate.png" alt="Torta Cuadrada de Chocolate" class="card-img-top" style="height:160px;object-fit:cover;">
          <div class="card-body d-flex flex-column">
            <h5 class="card-title">Torta Cuadrada de Chocolate</h5>
            <p class="card-text">Deliciosa torta de chocolate con capas de ganache y un toque de avellanas. Personalizable con mensajes especiales.</p>
            <div class="mt-auto text-center">
              <div class="price">$45.000 CLP</div>
              <button class="btn btn-add mt-2 btnPersonalizar">A√±adir</button>
            </div>
          </div>
        </div>
      </div>

      <!-- TC002 -->
      <div class="col-lg-3 col-md-4 col-sm-6 producto"
           data-cat="TORTA_CUADRADA" data-sizes="PEQUENA,MEDIANA,GRANDE" data-name="Torta Cuadrada de Frutas" data-price="50000">
        <div class="card h-100">
          <img src="assets/images/torta_frutas.png" alt="Torta Cuadrada de Frutas" class="card-img-top" style="height:160px;object-fit:cover;">
          <div class="card-body d-flex flex-column">
            <h5 class="card-title">Torta Cuadrada de Frutas</h5>
            <p class="card-text">Una mezcla de frutas frescas y crema chantilly sobre un suave bizcocho de vainilla, ideal para celebraciones.</p>
            <div class="mt-auto text-center">
              <div class="price">$50.000 CLP</div>
              <button class="btn btn-add mt-2 btnPersonalizar">A√±adir</button>
            </div>
          </div>
        </div>
      </div>

      <!-- Tortas Circulares -->
      <!-- TT001 -->
      <div class="col-lg-3 col-md-4 col-sm-6 producto"
           data-cat="TORTA_CIRCULAR" data-sizes="PEQUENA,MEDIANA,GRANDE" data-name="Torta Circular de Vainilla" data-price="40000">
        <div class="card h-100">
          <img src="assets/images/torta_vainilla.png" alt="Torta Circular de Vainilla" class="card-img-top" style="height:160px;object-fit:cover;">
          <div class="card-body d-flex flex-column">
            <h5 class="card-title">Torta Circular de Vainilla</h5>
            <p class="card-text">Bizcocho de vainilla cl√°sico relleno con crema pastelera y cubierto con un glaseado dulce, perfecto para cualquier ocasi√≥n.</p>
            <div class="mt-auto text-center">
              <div class="price">$40.000 CLP</div>
              <button class="btn btn-add mt-2 btnPersonalizar">A√±adir</button>
            </div>
          </div>
        </div>
      </div>

      <!-- TT002 -->
      <div class="col-lg-3 col-md-4 col-sm-6 producto"
           data-cat="TORTA_CIRCULAR" data-sizes="PEQUENA,MEDIANA,GRANDE" data-name="Torta Circular de Manjar" data-price="42000">
        <div class="card h-100">
          <img src="assets/images/torta_manjar.png" alt="Torta Circular de Manjar" class="card-img-top" style="height:160px;object-fit:cover;">
          <div class="card-body d-flex flex-column">
            <h5 class="card-title">Torta Circular de Manjar</h5>
            <p class="card-text">Torta tradicional chilena con manjar y nueces, un deleite para los amantes de los sabores dulces y cl√°sicos.</p>
            <div class="mt-auto text-center">
              <div class="price">$42.000 CLP</div>
              <button class="btn btn-add mt-2 btnPersonalizar">A√±adir</button>
            </div>
          </div>
        </div>
      </div>

      <!-- Postres Individuales -->
      <!-- PI001 -->
      <div class="col-lg-3 col-md-4 col-sm-6 producto"
           data-cat="INDIVIDUAL" data-sizes="" data-name="Mousse de Chocolate" data-price="5000">
        <div class="card h-100">
          <img src="assets/images/mousse.png" alt="Mousse de Chocolate" class="card-img-top" style="height:160px;object-fit:cover;">
          <div class="card-body d-flex flex-column">
            <h5 class="card-title">Mousse de Chocolate</h5>
            <p class="card-text">Postre individual cremoso y suave, hecho con chocolate de alta calidad, ideal para los amantes del chocolate.</p>
            <div class="mt-auto text-center">
              <div class="price">$5.000 CLP</div>
              <button class="btn btn-add mt-2 btnPersonalizar">A√±adir</button>
            </div>
          </div>
        </div>
      </div>

      <!-- PI002 -->
      <div class="col-lg-3 col-md-4 col-sm-6 producto"
           data-cat="INDIVIDUAL" data-sizes="" data-name="Tiramis√∫ Cl√°sico" data-price="5500">
        <div class="card h-100">
          <img src="assets/images/tiramisu.png" alt="Tiramis√∫ Cl√°sico" class="card-img-top" style="height:160px;object-fit:cover;">
          <div class="card-body d-flex flex-column">
            <h5 class="card-title">Tiramis√∫ Cl√°sico</h5>
            <p class="card-text">Un postre italiano individual con capas de caf√©, mascarpone y cacao, perfecto para finalizar cualquier comida.</p>
            <div class="mt-auto text-center">
              <div class="price">$5.500 CLP</div>
              <button class="btn btn-add mt-2 btnPersonalizar">A√±adir</button>
            </div>
          </div>
        </div>
      </div>

      <!-- Productos Sin Az√∫car -->
      <!-- PSA001 -->
      <div class="col-lg-3 col-md-4 col-sm-6 producto"
           data-cat="SIN_AZUCAR" data-sizes="PEQUENA,MEDIANA" data-name="Torta Sin Az√∫car de Naranja" data-price="48000">
        <div class="card h-100">
          <img src="assets/images/torta_naranja_sin_azucar.png" alt="Torta Sin Az√∫car de Naranja" class="card-img-top" style="height:160px;object-fit:cover;">
          <div class="card-body d-flex flex-column">
            <h5 class="card-title">Torta Sin Az√∫car de Naranja</h5>
            <p class="card-text">Torta ligera y deliciosa, endulzada naturalmente, ideal para quienes buscan opciones m√°s saludables.</p>
            <div class="mt-auto text-center">
              <div class="price">$48.000 CLP</div>
              <button class="btn btn-add mt-2 btnPersonalizar">A√±adir</button>
            </div>
          </div>
        </div>
      </div>

      <!-- PSA002 -->
      <div class="col-lg-3 col-md-4 col-sm-6 producto"
           data-cat="SIN_AZUCAR" data-sizes="PEQUENA,MEDIANA" data-name="Cheesecake Sin Az√∫car" data-price="47000">
        <div class="card h-100">
          <img src="assets/images/cheesecake_sin_azucar.png" alt="Cheesecake Sin Az√∫car" class="card-img-top" style="height:160px;object-fit:cover;">
          <div class="card-body d-flex flex-column">
            <h5 class="card-title">Cheesecake Sin Az√∫car</h5>
            <p class="card-text">Suave y cremoso, este cheesecake es una opci√≥n perfecta para disfrutar sin culpa.</p>
            <div class="mt-auto text-center">
              <div class="price">$47.000 CLP</div>
              <button class="btn btn-add mt-2 btnPersonalizar">A√±adir</button>
            </div>
          </div>
        </div>
      </div>

      <!-- Pasteler√≠a Tradicional -->
      <!-- PT001 -->
      <div class="col-lg-3 col-md-4 col-sm-6 producto"
           data-cat="TRADICIONAL" data-sizes="" data-name="Empanada de Manzana" data-price="3000">
        <div class="card h-100">
          <img src="assets/images/empanada_manzana.png" alt="Empanada de Manzana" class="card-img-top" style="height:160px;object-fit:cover;">
          <div class="card-body d-flex flex-column">
            <h5 class="card-title">Empanada de Manzana</h5>
            <p class="card-text">Pasteler√≠a tradicional rellena de manzanas especiadas, perfecta para un dulce desayuno o merienda.</p>
            <div class="mt-auto text-center">
              <div class="price">$3.000 CLP</div>
              <button class="btn btn-add mt-2 btnPersonalizar">A√±adir</button>
            </div>
          </div>
        </div>
      </div>

      <!-- PT002 -->
      <div class="col-lg-3 col-md-4 col-sm-6 producto"
           data-cat="TRADICIONAL" data-sizes="" data-name="Tarta de Santiago" data-price="6000">
        <div class="card h-100">
          <img src="assets/images/tarta_santiago.png" alt="Tarta de Santiago" class="card-img-top" style="height:160px;object-fit:cover;">
          <div class="card-body d-flex flex-column">
            <h5 class="card-title">Tarta de Santiago</h5>
            <p class="card-text">Tradicional tarta espa√±ola hecha con almendras, az√∫car y huevos, una delicia para los amantes de los postres cl√°sicos.</p>
            <div class="mt-auto text-center">
              <div class="price">$6.000 CLP</div>
              <button class="btn btn-add mt-2 btnPersonalizar">A√±adir</button>
            </div>
          </div>
        </div>
      </div>

      <!-- Productos Sin Gluten -->
      <!-- PG001 -->
      <div class="col-lg-3 col-md-4 col-sm-6 producto"
           data-cat="SIN_GLUTEN" data-sizes="" data-name="Brownie Sin Gluten" data-price="4000">
        <div class="card h-100">
          <img src="assets/images/brownie.png" alt="Brownie Sin Gluten" class="card-img-top" style="height:160px;object-fit:cover;">
          <div class="card-body d-flex flex-column">
            <h5 class="card-title">Brownie Sin Gluten</h5>
            <p class="card-text">Rico y denso, este brownie es perfecto para quienes necesitan evitar el gluten sin sacrificar el sabor.</p>
            <div class="mt-auto text-center">
              <div class="price">$4.000 CLP</div>
              <button class="btn btn-add mt-2 btnPersonalizar">A√±adir</button>
            </div>
          </div>
        </div>
      </div>

      <!-- PG002 -->
      <div class="col-lg-3 col-md-4 col-sm-6 producto"
           data-cat="SIN_GLUTEN" data-sizes="" data-name="Pan Sin Gluten" data-price="3500">
        <div class="card h-100">
          <img src="assets/images/pan_sin_gluten.png" alt="Pan Sin Gluten" class="card-img-top" style="height:160px;object-fit:cover;">
          <div class="card-body d-flex flex-column">
            <h5 class="card-title">Pan Sin Gluten</h5>
            <p class="card-text">Suave y esponjoso, ideal para s√°ndwiches o para acompa√±ar cualquier comida.</p>
            <div class="mt-auto text-center">
              <div class="price">$3.500 CLP</div>
              <button class="btn btn-add mt-2 btnPersonalizar">A√±adir</button>
            </div>
          </div>
        </div>
      </div>

      <!-- Productos Veganos -->
      <!-- PV001 -->
      <div class="col-lg-3 col-md-4 col-sm-6 producto"
           data-cat="VEGANA" data-sizes="PEQUENA,MEDIANA" data-name="Torta Vegana de Chocolate" data-price="50000">
        <div class="card h-100">
          <img src="assets/images/torta_vegana_chocolate.png" alt="Torta Vegana de Chocolate" class="card-img-top" style="height:160px;object-fit:cover;">
          <div class="card-body d-flex flex-column">
            <h5 class="card-title">Torta Vegana de Chocolate</h5>
            <p class="card-text">Torta de chocolate h√∫meda y deliciosa, hecha sin productos de origen animal, perfecta para veganos.</p>
            <div class="mt-auto text-center">
              <div class="price">$50.000 CLP</div>
              <button class="btn btn-add mt-2 btnPersonalizar">A√±adir</button>
            </div>
          </div>
        </div>
      </div>

      <!-- PV002 -->
      <div class="col-lg-3 col-md-4 col-sm-6 producto"
           data-cat="VEGANA" data-sizes="" data-name="Galletas Veganas de Avena" data-price="4500">
        <div class="card h-100">
          <img src="assets/images/galletas_veganas_avena.png" alt="Galletas Veganas de Avena" class="card-img-top" style="height:160px;object-fit:cover;">
          <div class="card-body d-flex flex-column">
            <h5 class="card-title">Galletas Veganas de Avena</h5>
            <p class="card-text">Crujientes y sabrosas, estas galletas son una excelente opci√≥n para un snack saludable y vegano.</p>
            <div class="mt-auto text-center">
              <div class="price">$4.500 CLP</div>
              <button class="btn btn-add mt-2 btnPersonalizar">A√±adir</button>
            </div>
          </div>
        </div>
      </div>

      <!-- Tortas Especiales -->
      <!-- TE001 -->
      <div class="col-lg-3 col-md-4 col-sm-6 producto"
           data-cat="ESPECIAL" data-sizes="PEQUENA,MEDIANA,GRANDE" data-name="Torta Especial de Cumplea√±os" data-price="55000">
        <div class="card h-100">
          <img src="assets/images/torta_cumpleanos.png" alt="Torta Especial de Cumplea√±os" class="card-img-top" style="height:160px;object-fit:cover;">
          <div class="card-body d-flex flex-column">
            <h5 class="card-title">Torta Especial de Cumplea√±os</h5>
            <p class="card-text">Dise√±ada especialmente para celebraciones, personalizable con decoraciones y mensajes √∫nicos.</p>
            <div class="mt-auto text-center">
              <div class="price">$55.000 CLP</div>
              <button class="btn btn-add mt-2 btnPersonalizar">A√±adir</button>
            </div>
          </div>
        </div>
      </div>

      <!-- TE002 -->
      <div class="col-lg-3 col-md-4 col-sm-6 producto"
           data-cat="ESPECIAL" data-sizes="PEQUENA,MEDIANA,GRANDE" data-name="Torta Especial de Boda" data-price="60000">
        <div class="card h-100">
          <img src="assets/images/torta_boda.png" alt="Torta Especial de Boda" class="card-img-top" style="height:160px;object-fit:cover;">
          <div class="card-body d-flex flex-column">
            <h5 class="card-title">Torta Especial de Boda</h5>
            <p class="card-text">Elegante y deliciosa, esta torta est√° dise√±ada para ser el centro de atenci√≥n en cualquier boda.</p>
            <div class="mt-auto text-center">
              <div class="price">$60.000 CLP</div>
              <button class="btn btn-add mt-2 btnPersonalizar">A√±adir</button>
            </div>
          </div>
        </div>
      </div>

    </div>
  </main>

  <!-- MODAL PERSONALIZACI√ìN -->
  <div class="modal fade" id="modalPersonalizar" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header" style="background:#ffecec;border-bottom:1px solid #FFC0CB;">
          <h5 class="modal-title" id="modalTitle" style="color:#8B4513;">Personalizar producto</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
        </div>
        <div class="modal-body">
          <form id="formPersonalizar" novalidate>
            <div class="mb-3">
              <label class="form-label">Producto</label>
              <input type="text" id="modalProducto" class="form-control" disabled>
            </div>
            <div class="mb-3">
              <label class="form-label">Tama√±o (solo si aplica)</label>
              <select id="modalTamano" class="form-select">
                <option value="">‚Äî Seleccione tama√±o ‚Äî</option>
                <option value="PEQUENA">Peque√±a</option>
                <option value="MEDIANA">Mediana</option>
                <option value="GRANDE">Grande</option>
              </select>
              <div class="form-text">Para postres individuales no es necesario.</div>
            </div>
            <div class="mb-3">
              <label class="form-label">Mensaje especial (opcional)</label>
              <input type="text" id="modalMensaje" class="form-control" maxlength="30" placeholder="Feliz Cumplea√±os, Ana">
              <div class="form-text"><span id="charCount">0</span>/30</div>
            </div>
          </form>
          <div class="alert alert-success d-none" id="okAdd">¬°Producto agregado!</div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
          <a href="carrito.html" id="btnIrCarrito" class="btn d-none" style="background:#FFC0CB;color:#5D4037;font-weight:600;">Ir al carrito</a>
          <button id="btnConfirmar" class="btn" style="background:#FFC0CB;color:#5D4037;font-weight:600;">A√±adir</button>
        </div>
      </div>
    </div>
  </div>

  <footer>
    <small>&copy; 2025 Pasteler√≠a Mil Sabores</small>
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // ---------- Utilidades de carrito (localStorage) ----------
    function getCart(){
      try { return JSON.parse(localStorage.getItem('cartItems') || '[]'); }
      catch(e){ return []; }
    }
    function setCart(items){
      localStorage.setItem('cartItems', JSON.stringify(items));
    }
    function cartCount(){
      const items = getCart();
      return items.reduce((sum, it) => sum + (it.qty || 1), 0);
    }
    function updateCartLink(){
      var link = document.getElementById('cartLink');
      if(link){ link.textContent = 'Carrito (' + cartCount() + ')'; }
    }

    // ---------- FILTROS ----------
    const selCat = document.getElementById('filtroCategoria');
    const selTam = document.getElementById('filtroTamano');
    const btnLimpiar = document.getElementById('btnLimpiar');
    const grid = document.getElementById('gridProductos');

    function aplicaFiltros(){
      const cat = selCat.value;
      const tam = selTam.value;
      const items = grid.getElementsByClassName('producto');

      for (let i = 0; i < items.length; i++){
        const el = items[i];
        const elCat = el.getAttribute('data-cat');
        const sizes = (el.getAttribute('data-sizes') || '').split(',').filter(Boolean);

        let okCat = (cat === 'TODAS') || (elCat === cat);
        let okTam = (tam === 'TODOS') || (sizes.includes(tam));
        if (sizes.length === 0 && tam !== 'TODOS') okTam = true; // postres sin tama√±o

        el.style.display = (okCat && okTam) ? '' : 'none';
      }
    }
    selCat.addEventListener('change', aplicaFiltros);
    selTam.addEventListener('change', aplicaFiltros);
    btnLimpiar.addEventListener('click', function(){
      selCat.value = 'TODAS';
      selTam.value = 'TODOS';
      aplicaFiltros();
    });

    // ---------- MODAL PERSONALIZACI√ìN ----------
    const modalEl = document.getElementById('modalPersonalizar');
    const bsModal = new bootstrap.Modal(modalEl);
    const modalProducto = document.getElementById('modalProducto');
    const modalTamano = document.getElementById('modalTamano');
    const modalMensaje = document.getElementById('modalMensaje');
    const okAdd = document.getElementById('okAdd');
    const charCount = document.getElementById('charCount');
    const btnIrCarrito = document.getElementById('btnIrCarrito');

    modalMensaje.addEventListener('input', () => charCount.textContent = modalMensaje.value.length);

    function wireButtons(){
      const botones = document.getElementsByClassName('btnPersonalizar');
      for (let i = 0; i < botones.length; i++){
        botones[i].addEventListener('click', function(e){
          const card = e.target.closest('.producto');
          const name = card.getAttribute('data-name');
          const sizes = (card.getAttribute('data-sizes') || '').split(',').filter(Boolean);

          modalProducto.value = name;
          modalMensaje.value = '';
          charCount.textContent = '0';
          okAdd.classList.add('d-none');
          btnIrCarrito.classList.add('d-none');

          modalTamano.value = '';
          modalTamano.disabled = sizes.length === 0;

          modalEl.dataset.price = card.getAttribute('data-price') || '0';
          modalEl.dataset.cat = card.getAttribute('data-cat');

          bsModal.show();
        });
      }
    }
    wireButtons();

    document.getElementById('btnConfirmar').addEventListener('click', function(){
      if (!modalTamano.disabled && modalTamano.value === ''){
        alert('Selecciona un tama√±o para esta torta.');
        return;
      }

      const item = {
        name: modalProducto.value,
        size: modalTamano.disabled ? '' : modalTamano.value,
        message: modalMensaje.value.trim(),
        price: Number(modalEl.dataset.price || 0),
        category: modalEl.dataset.cat || '',
        qty: 1
      };

      const items = getCart();
      var idx = -1;
      for (var i=0; i<items.length; i++){
        if (items[i].name === item.name && items[i].size === item.size && items[i].message === item.message){
          idx = i; break;
        }
      }
      if (idx >= 0) items[idx].qty += 1;
      else items.push(item);
      setCart(items);

      okAdd.classList.remove('d-none');
      btnIrCarrito.classList.remove('d-none');
      updateCartLink();
      // Redirigir autom√°tico (opcional):
      // setTimeout(()=>location.href='carrito.html',700);
    });

    // Inicializar contador al cargar
    updateCartLink();
  </script>
</body>
</html>
